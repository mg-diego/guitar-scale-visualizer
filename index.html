<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualizador de Escalas</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #1a1a1a;
    color: #f0f0f0;
    margin: 0;
    padding: 2rem 0;
  }

  h1 {
    margin-bottom: 1rem;
  }

  .controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
  }

  select {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    background-color: #333;
    color: #fff;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
  }

  .scale-info-panel {
    display: flex;
    flex-direction: column;
    gap: 10px;
    background-color: #2a2a2a;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    width: 90%;
    max-width: 800px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }

  .info-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #444;
    padding-bottom: 10px;
    margin-bottom: 5px;
  }

  .info-title {
    font-weight: bold;
    color: #dcb98a;
    font-size: 1.1rem;
  }

  .toggle-group {
    display: flex;
    gap: 1rem;
    background: #1a1a1a;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.9rem;
  }

  .toggle-group label {
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .info-row {
    display: flex;
    align-items: center;
    margin-top: 5px;
  }

  .info-label {
    width: 120px;
    color: #dcb98a;
    font-weight: bold;
    font-size: 0.95rem;
  }

  .info-values {
    display: grid;
    grid-auto-columns: 1fr;
    grid-auto-flow: column;
    gap: 10px;
    flex: 1;
    overflow-x: auto;
  }

  .info-box {
    width: 100%;
    min-width: 55px;
    text-align: center;
    background-color: #3a3a3a;
    padding: 6px 5px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 0.85rem;
    box-sizing: border-box;
  }

  .color-select {
    width: 100%;
    min-width: 55px;
    padding: 6px 0;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    box-sizing: border-box;
    text-align: center;
    font-weight: bold;
    font-size: 0.85rem;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
  }

  .color-select:focus {
    outline: 2px solid #dcb98a;
  }

  .view-toggle {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2rem;
    background: #2a2a2a;
    padding: 10px 20px;
    border-radius: 8px;
  }

  .view-toggle label {
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  #boards-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3rem;
  }

  .fretboard-wrapper {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .position-title {
    color: #dcb98a;
    margin-bottom: 1rem;
    font-size: 1.2rem;
  }

  .fretboard-container {
    width: 100%;
    padding: 0 2rem;
    box-sizing: border-box;
    overflow-x: auto;
    display: flex;
    justify-content: center;
  }

  .fretboard {
    display: grid;
    background-color: #3a2a1a;
    border: 2px solid #8b5a2b;
    border-radius: 4px;
    padding: 10px 20px 10px 0;
    box-sizing: border-box;
  }

  .fret-number {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    padding-bottom: 8px;
    color: #dcb98a;
    font-size: 14px;
    font-weight: bold;
  }

  .tuning-label {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: bold;
    font-size: 16px;
    padding-right: 5px;
  }

  .string-cell {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    border-right: 3px solid silver;
    height: 40px;
  }

  .string-cell.nut {
    border-right: 6px solid #e0e0e0;
    background-color: #2a1a0a;
  }

  .string-line {
    position: absolute;
    left: 0;
    right: 0;
    background-color: #a0a0a0;
    z-index: 1;
  }

  .row-0 .string-line { height: 1px; }
  .row-1 .string-line { height: 1.5px; }
  .row-2 .string-line { height: 2px; }
  .row-3 .string-line { height: 2.5px; }
  .row-4 .string-line { height: 3px; }
  .row-5 .string-line { height: 3.5px; }

  .note-marker {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    color: white;
    font-size: 12px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    visibility: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  }

  .active .note-marker {
    visibility: visible;
  }
</style>
</head>
<body>

  <h1 id="scale-title">Escala Pentatónica Menor (A)</h1>
  
  <div class="controls">
    <select id="root-select"></select>
    <select id="scale-select"></select>
  </div>

  <div class="scale-info-panel" id="scale-info-panel"></div>

  <div class="view-toggle">
    <label><input type="radio" name="view-mode" value="full" checked> Diapasón Completo</label>
    <label><input type="radio" name="view-mode" value="positions"> Por Posiciones</label>
  </div>

  <div id="boards-container"></div>

<script>
  const tuning = ['E', 'B', 'G', 'D', 'A', 'E'];
  const chromaticNotes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
  const intervalNames = {0: '1', 1: 'b2', 2: '2', 3: 'b3', 4: '3', 5: '4', 6: 'b5', 7: '5', 8: 'b6', 9: '6', 10: 'b7', 11: '7'};
  const frets = 24;
  
  const scales = {
    'ionian': { name: 'Jónica (Mayor)', intervals: [0, 2, 4, 5, 7, 9, 11], triads: ['Maj', 'm', 'm', 'Maj', 'Maj', 'm', 'dim'], tetrads: ['Maj7', 'm7', 'm7', 'Maj7', '7', 'm7', 'm7b5'] },
    'dorian': { name: 'Dórica', intervals: [0, 2, 3, 5, 7, 9, 10], triads: ['m', 'm', 'Maj', 'Maj', 'm', 'dim', 'Maj'], tetrads: ['m7', 'm7', 'Maj7', '7', 'm7', 'm7b5', 'Maj7'] },
    'phrygian': { name: 'Frigia', intervals: [0, 1, 3, 5, 7, 8, 10], triads: ['m', 'Maj', 'Maj', 'm', 'dim', 'Maj', 'm'], tetrads: ['m7', 'Maj7', '7', 'm7', 'm7b5', 'Maj7', 'm7'] },
    'lydian': { name: 'Lidia', intervals: [0, 2, 4, 6, 7, 9, 11], triads: ['Maj', 'Maj', 'm', 'dim', 'Maj', 'm', 'm'], tetrads: ['Maj7', '7', 'm7', 'm7b5', 'Maj7', 'm7', 'm7'] },
    'mixolydian': { name: 'Mixolidia', intervals: [0, 2, 4, 5, 7, 9, 10], triads: ['Maj', 'm', 'dim', 'Maj', 'm', 'm', 'Maj'], tetrads: ['7', 'm7', 'm7b5', 'Maj7', 'm7', 'm7', 'Maj7'] },
    'aeolian': { name: 'Eólica (Menor)', intervals: [0, 2, 3, 5, 7, 8, 10], triads: ['m', 'dim', 'Maj', 'm', 'm', 'Maj', 'Maj'], tetrads: ['m7', 'm7b5', 'Maj7', 'm7', 'm7', 'Maj7', '7'] },
    'locrian': { name: 'Locria', intervals: [0, 1, 3, 5, 6, 8, 10], triads: ['dim', 'Maj', 'm', 'm', 'Maj', 'Maj', 'm'], tetrads: ['m7b5', 'Maj7', 'm7', 'm7', 'Maj7', '7', 'm7'] },
    'blues': { name: 'Blues', intervals: [0, 3, 5, 6, 7, 10], triads: ['m', 'Maj', 'm', 'dim', 'm', 'Maj'], tetrads: ['m7', 'Maj7', 'm7', 'dim7', 'm7', '7'] },
    'pentatonic-minor': { name: 'Pentatónica Menor', intervals: [0, 3, 5, 7, 10], triads: ['m', 'Maj', 'm', 'm', 'Maj'], tetrads: ['m7', 'Maj7', 'm7', 'm7', '7'] },
    'pentatonic-major': { name: 'Pentatónica Mayor', intervals: [0, 2, 4, 7, 9], triads: ['Maj', 'm', 'm', '5', 'm'], tetrads: ['Maj7', 'm7', 'm7', '7', 'm7'] },
    'harmonic-minor': { name: 'Menor Armónica', intervals: [0, 2, 3, 5, 7, 8, 11], triads: ['m', 'dim', 'aug', 'm', 'Maj', 'Maj', 'dim'], tetrads: ['mMaj7', 'm7b5', 'Maj7#5', 'm7', '7', 'Maj7', 'dim7'] },
    'harmonic-major': { name: 'Mayor Armónica', intervals: [0, 2, 4, 5, 7, 8, 11], triads: ['Maj', 'dim', 'm', 'm', 'Maj', 'aug', 'dim'], tetrads: ['Maj7', 'm7b5', 'm7', 'mMaj7', '7', 'Maj7#5', 'dim7'] },
    'melodic-minor': { name: 'Menor Melódica', intervals: [0, 2, 3, 5, 7, 9, 11], triads: ['m', 'm', 'aug', 'Maj', 'Maj', 'dim', 'dim'], tetrads: ['mMaj7', 'm7', 'Maj7#5', '7', '7', 'm7b5', 'm7b5'] },
    'double-harmonic': { name: 'Doble Armónica', intervals: [0, 1, 4, 5, 7, 8, 11], triads: ['Maj', 'Maj', 'm', 'm', 'dim', 'aug', 'm'], tetrads: ['Maj7', 'Maj7', 'm7', 'mMaj7', '7b5', 'Maj7#5', 'm7'] },
    'hungarian': { name: 'Húngara', intervals: [0, 2, 3, 6, 7, 8, 11], triads: ['m', 'dim', 'm', 'm', 'm', 'aug', 'Maj'], tetrads: ['7', 'dim7', 'mMaj7b5', 'm7b5', 'mMaj7#5', 'm7', 'Maj7#5'] },
    'persian': { name: 'Persa', intervals: [0, 1, 4, 5, 6, 8, 11], triads: ['dim', 'm', 'm', 'm', 'Maj', 'aug', 'dim'], tetrads: ['Maj7b5', 'Maj7', 'm', 'mMaj7', 'Maj7#3', 'Maj7#5', 'dim7'] },
    'neopolitan': { name: 'Napolitana', intervals: [0, 1, 3, 5, 7, 9, 11], triads: ['m', 'Maj', 'aug', 'Maj', 'Maj', 'dim', 'dim'], tetrads: ['mMaj7', 'Maj7#5', 'Maj7#5', 'Maj7', '7b5', 'm7b5', 'dim7'] },
    'neopolitan-minor': { name: 'Menor Napolitana', intervals: [0, 1, 3, 5, 7, 8, 11], triads: ['m', 'Maj', 'aug', 'm', 'Maj', 'Maj', 'dim'], tetrads: ['mMaj7', 'Maj7', '7#5', 'm7b5', '7b5', 'Maj7', 'dim7'] },
    'diminished': { name: 'Disminuida', intervals: [0, 2, 3, 5, 6, 8, 9, 11], triads: ['dim', 'dim', 'dim', 'dim', 'dim', 'dim', 'dim', 'dim'], tetrads: ['dim7', 'dim7', 'dim7', 'dim7', 'dim7', 'dim7', 'dim7', 'dim7'] },
    'augmented': { name: 'Aumentada', intervals: [0, 3, 4, 7, 8, 11], triads: ['aug', 'aug', 'aug', 'aug', 'aug', 'aug'], tetrads: ['Maj7#5', 'Maj7#5', 'Maj7#5', 'Maj7#5', 'Maj7#5', 'Maj7#5'] },
    'm7-arpeggio': { name: 'Arpegio M7', intervals: [0, 4, 7, 11], triads: ['Maj', 'm', 'm', 'dim'], tetrads: ['Maj7', 'm7', '7', 'm7b5'] },
    'min7-arpeggio': { name: 'Arpegio m7', intervals: [0, 3, 7, 10], triads: ['m', 'Maj', 'm', 'Maj'], tetrads: ['m7', 'Maj7', 'm7', '7'] },
    'dom7-arpeggio': { name: 'Arpegio Dominante', intervals: [0, 4, 7, 10], triads: ['Maj', 'dim', 'm', 'Maj'], tetrads: ['7', 'dim7', 'm7', 'Maj7'] },
    'major-triad': { name: 'Tríada Mayor', intervals: [0, 4, 7], triads: ['Maj', 'm', 'm'], tetrads: ['Maj7', 'm7', '7'] },
    'minor-triad': { name: 'Tríada Menor', intervals: [0, 3, 7], triads: ['m', 'Maj', 'm'], tetrads: ['m7', 'Maj7', 'm7'] },
    'hirajoshi': { name: 'Hirajōshi (6th)', intervals: [0, 2, 3, 7, 8], triads: ['m', 'dim', 'Maj', 'm', 'Maj'], tetrads: ['m7', 'm7b5', 'Maj7', 'm7', 'Maj7'] },
    'iwato': { name: 'Iwato (7th)', intervals: [0, 1, 5, 6, 10], triads: ['dim', 'Maj', 'm', 'm', 'Maj'], tetrads: ['m7b5', 'Maj7', 'm7', 'm7', 'Maj7'] },
    'kumoi': { name: 'Kumoi (1st)', intervals: [0, 2, 3, 7, 9], triads: ['m', 'm', 'Maj', 'm', 'dim'], tetrads: ['m7', 'm7', 'Maj7', 'm7', 'm7b5'] },
    'hon-kumoi': { name: 'Hon Kumoi-joshi', intervals: [0, 1, 5, 7, 8], triads: ['m', 'Maj', 'Maj', 'm', 'dim'], tetrads: ['m7', 'Maj7', '7', 'm7', 'm7b5'] },
    'chinese': { name: 'China (4th)', intervals: [0, 4, 6, 7, 11], triads: ['Maj', 'dim', 'm', 'm', 'Maj'], tetrads: ['Maj7', 'm7b5', 'm7', 'm7', 'Maj7'] }
  };

  const predefinedColors = {
    '#7f8c8d': 'Gris',
    '#e74c3c': 'Rojo',
    '#3498db': 'Azul',
    '#2ecc71': 'Verde',
    '#f1c40f': 'Amarillo',
    '#9b59b6': 'Morado',
    '#e67e22': 'Naranja',
    '#e84393': 'Rosa'
  };

  const defaultIntervalColors = {
    0: '#e74c3c',
    3: '#3498db',
    4: '#3498db',
    7: '#f1c40f'
  };
  
  let userColors = {};

  const rootSelect = document.getElementById('root-select');
  const scaleSelect = document.getElementById('scale-select');
  const boardsContainer = document.getElementById('boards-container');
  const scaleTitle = document.getElementById('scale-title');
  const scaleInfoPanel = document.getElementById('scale-info-panel');
  const viewRadios = document.querySelectorAll('input[name="view-mode"]');

  function initSelectors() {
    chromaticNotes.forEach(note => {
      let option = document.createElement('option');
      option.value = note;
      option.textContent = note;
      if (note === 'A') option.selected = true;
      rootSelect.appendChild(option);
    });

    Object.entries(scales).forEach(([key, scaleData]) => {
      let option = document.createElement('option');
      option.value = key;
      option.textContent = scaleData.name;
      if (key === 'pentatonic-minor') option.selected = true;
      scaleSelect.appendChild(option);
    });

    rootSelect.addEventListener('change', updateAll);
    scaleSelect.addEventListener('change', updateAll);
    viewRadios.forEach(radio => radio.addEventListener('change', renderBoards));
  }

  function getIntervalColor(interval) {
    if (userColors[interval]) return userColors[interval];
    return defaultIntervalColors[interval] || '#7f8c8d';
  }

  function getScaleNotes(root, scaleKey) {
    const rootIndex = chromaticNotes.indexOf(root);
    const intervals = scales[scaleKey].intervals;
    return intervals.map(interval => chromaticNotes[(rootIndex + interval) % 12]);
  }

  function renderScaleInfo(root, scaleKey, scaleNotes) {
    const intervalsData = scales[scaleKey].intervals;
    const intervalsNames = intervalsData.map(i => intervalNames[i]);
    
    const existingToggle = document.querySelector('input[name="chord-type"]:checked');
    const chordType = existingToggle ? existingToggle.value : 'triads';
    
    const chords = scales[scaleKey][chordType];

    let notesHtml = scaleNotes.map(n => `<div class="info-box">${n}</div>`).join('');
    let intervalsHtml = intervalsNames.map(i => `<div class="info-box" style="background-color:#2c3e50;">${i}</div>`).join('');
    let chordsHtml = scaleNotes.map((n, idx) => {
      let chordStr = chords[idx] !== undefined ? `${n}${chords[idx]}` : '-';
      return `<div class="info-box" style="background-color:#8b5a2b;">${chordStr}</div>`;
    }).join('');
    
    let colorHtml = intervalsData.map(i => {
      let currentColor = getIntervalColor(i);
      let optionsHtml = Object.entries(predefinedColors).map(([hex, name]) => {
        return `<option value="${hex}" ${currentColor === hex ? 'selected' : ''}>${name}</option>`;
      }).join('');
      
      let textColor = (currentColor === '#f1c40f' || currentColor === '#2ecc71') ? '#000' : '#fff';
      
      return `
        <select class="color-select" data-interval="${i}" style="background-color: ${currentColor}; color: ${textColor};">
          ${optionsHtml}
        </select>
      `;
    }).join('');

    scaleInfoPanel.innerHTML = `
      <div class="info-header">
        <div class="info-title">Detalles de la Escala</div>
        <div class="toggle-group">
          <label><input type="radio" name="chord-type" value="triads" ${chordType === 'triads' ? 'checked' : ''}> Tríadas</label>
          <label><input type="radio" name="chord-type" value="tetrads" ${chordType === 'tetrads' ? 'checked' : ''}> Tétradas</label>
        </div>
      </div>
      <div class="info-row">
        <div class="info-label">Notas</div>
        <div class="info-values">${notesHtml}</div>
      </div>
      <div class="info-row">
        <div class="info-label">Intervalos</div>
        <div class="info-values">${intervalsHtml}</div>
      </div>
      <div class="info-row">
        <div class="info-label">Armonización</div>
        <div class="info-values">${chordsHtml}</div>
      </div>
      <div class="info-row">
        <div class="info-label">Colores</div>
        <div class="info-values">${colorHtml}</div>
      </div>
    `;

    document.querySelectorAll('input[name="chord-type"]').forEach(radio => {
      radio.addEventListener('change', () => renderScaleInfo(root, scaleKey, scaleNotes));
    });

    document.querySelectorAll('.color-select').forEach(select => {
      select.addEventListener('change', (e) => {
        const interval = parseInt(e.target.getAttribute('data-interval'));
        const newColor = e.target.value;
        userColors[interval] = newColor;
        
        let textColor = (newColor === '#f1c40f' || newColor === '#2ecc71') ? '#000' : '#fff';
        e.target.style.backgroundColor = newColor;
        e.target.style.color = textColor;
        
        document.querySelectorAll(`.note-marker[data-interval="${interval}"]`).forEach(marker => {
          marker.style.backgroundColor = newColor;
          marker.style.color = textColor;
        });
      });
    });
  }

  function createFretboardDOM(rootNote, scaleNotes, spanStart, spanEnd, activeNotesList, title) {
    const wrapper = document.createElement('div');
    wrapper.className = 'fretboard-wrapper';

    if (title) {
      const h3 = document.createElement('h3');
      h3.className = 'position-title';
      h3.textContent = title;
      wrapper.appendChild(h3);
    }

    const container = document.createElement('div');
    container.className = 'fretboard-container';

    const fretboard = document.createElement('div');
    fretboard.className = 'fretboard';
    
    let gridCols = '40px ';
    for (let i = spanStart; i <= spanEnd; i++) {
      gridCols += (i === 0) ? '40px ' : 'minmax(45px, 1fr) ';
    }
    fretboard.style.gridTemplateColumns = gridCols;
    
    fretboard.style.minWidth = '1200px';
    fretboard.style.width = '100%';

    let emptyHeader = document.createElement('div');
    fretboard.appendChild(emptyHeader);
    
    for (let i = spanStart; i <= spanEnd; i++) {
      let header = document.createElement('div');
      header.className = 'fret-number';
      header.textContent = i === 0 ? '0' : i;
      fretboard.appendChild(header);
    }

    const rootIndexGlobal = chromaticNotes.indexOf(rootNote);

    tuning.forEach((openStringNote, stringIndex) => {
      let labelCell = document.createElement('div');
      labelCell.className = 'tuning-label';
      labelCell.textContent = openStringNote;
      fretboard.appendChild(labelCell);

      let stringRootIndex = chromaticNotes.indexOf(openStringNote);
      
      for (let fret = spanStart; fret <= spanEnd; fret++) {
        let currentNote = chromaticNotes[(stringRootIndex + fret) % 12];
        let currentNoteIndex = chromaticNotes.indexOf(currentNote);
        let interval = (currentNoteIndex - rootIndexGlobal + 12) % 12;
        
        let cell = document.createElement('div');
        cell.className = `string-cell row-${stringIndex}`;
        if (fret === 0) cell.classList.add('nut');
        
        let stringLine = document.createElement('div');
        stringLine.className = 'string-line';
        
        let noteMarker = document.createElement('div');
        noteMarker.className = 'note-marker';
        noteMarker.textContent = currentNote;
        noteMarker.setAttribute('data-interval', interval);
        
        let isActive = false;
        if (activeNotesList) {
          isActive = activeNotesList.some(n => n.string === stringIndex && n.fret === fret);
        } else {
          isActive = scaleNotes.includes(currentNote);
        }

        if (isActive) {
          cell.classList.add('active');
          let bgColor = getIntervalColor(interval);
          noteMarker.style.backgroundColor = bgColor;
          noteMarker.style.color = (bgColor === '#f1c40f' || bgColor === '#2ecc71') ? '#000' : '#fff';
        }
        
        cell.appendChild(stringLine);
        cell.appendChild(noteMarker);
        fretboard.appendChild(cell);
      }
    });

    container.appendChild(fretboard);
    wrapper.appendChild(container);
    return wrapper;
  }

  function renderBoards() {
    const selectedRoot = rootSelect.value;
    const selectedScaleKey = scaleSelect.value;
    const scaleNotes = getScaleNotes(selectedRoot, selectedScaleKey);
    const viewMode = document.querySelector('input[name="view-mode"]:checked').value;
    
    boardsContainer.innerHTML = '';

    if (viewMode === 'full') {
      boardsContainer.appendChild(createFretboardDOM(selectedRoot, scaleNotes, 0, frets, null, null));
    } else {
      const N = scaleNotes.length;
      const nps = N <= 5 ? 2 : 3;
      const stringBases = [24, 19, 15, 10, 5, 0];
      const eRootIndex = chromaticNotes.indexOf('E');
      
      let positionsData = [];

      for (let p = 0; p < N; p++) {
        let activeNotes = [];
        let startNote = scaleNotes[p];
        
        let baseFret = (chromaticNotes.indexOf(startNote) - eRootIndex + 12) % 12;
        let currentPitch = baseFret;

        for (let s = 5; s >= 0; s--) {
          let found = 0;
          while (found < nps) {
            let noteName = chromaticNotes[(eRootIndex + currentPitch) % 12];
            if (scaleNotes.includes(noteName)) {
              let fret = currentPitch - stringBases[s];
              if (fret < 0) {
                fret += 12;
                currentPitch += 12;
              }
              activeNotes.push({string: s, fret: fret, note: noteName});
              found++;
            }
            currentPitch++;
          }
        }

        let string6Note = activeNotes.find(n => n.string === 5);
        let startFret = string6Note ? string6Note.fret : 0;

        if (startFret === 0) {
          activeNotes = activeNotes.map(n => ({...n, fret: n.fret + 12}));
          startFret += 12;
        }

        positionsData.push({
          activeNotes: activeNotes,
          startFret: startFret
        });
      }

      positionsData.sort((a, b) => a.startFret - b.startFret);

      positionsData.forEach((pos, index) => {
        let title = `Posición ${index + 1} (inicia en traste ${pos.startFret})`;
        boardsContainer.appendChild(createFretboardDOM(selectedRoot, scaleNotes, 0, frets, pos.activeNotes, title));
      });
    }
  }

  function updateAll() {
    const selectedRoot = rootSelect.value;
    const selectedScaleKey = scaleSelect.value;
    const scaleNotes = getScaleNotes(selectedRoot, selectedScaleKey);
    const scaleName = scales[selectedScaleKey].name;
    
    scaleTitle.textContent = `Escala ${scaleName} (${selectedRoot})`;
    
    renderScaleInfo(selectedRoot, selectedScaleKey, scaleNotes);
    renderBoards();
  }

  initSelectors();
  updateAll();
</script>
</body>
</html>